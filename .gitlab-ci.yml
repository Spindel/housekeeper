stages:
    - test
    - publish

test:
    image: registry.gitlab.com/modioab/base-image/fedora-31/build:master
    stage: test
    when: always
    script:
        - pip3 install -r requirements-dev.txt
        - pip3 install .
        - pytest .
        - mypy .
        - flake8 .
    coverage: '/^TOTAL.+?(\d+\%)$/'
    artifacts:
        reports:
            junit: 
                - testreport.xml
                - mypyreport.xml

container:
    image: registry.gitlab.com/modioab/base-image/fedora-31/build:master
    stage: publish
    tags:
        - x86_64
    script:
        - make -f build.mk login
        - pip3 install wheel
        - make build-publish
