stages:
    - test
    - publish

before_script:
    - uname -a

test:
    image: registry.gitlab.com/modioab/base-image/fedora-29/build:master
    stage: test
    when: always
    script:
        - pip3 install .[testing]
        - pip3 install flake8 mypy
        - python3 setup.py test
        - mypy .
        - python3 setup.py flake8

container:
    image: registry.gitlab.com/modioab/base-image/fedora-29/container:master
    stage: publish
    tags:
        - x86_64
    script:
        - make -f build.mk login
        - make build-publish
